pipeline {
    agent any
    environment {
        SERVICE_NAME = 'spring-petclinic-app'
        RAILWAY_TOKEN = credentials('api-token-deploy')
    }
    stages {
        stage('Checkout') {
            steps { checkout scm }
        }
        stage('Deploy to Railway') {
            steps {
                    bat """
                    docker run --rm -e RAILWAY_TOKEN=%RAILWAY_TOKEN% -e SERVICE_NAME=%SERVICE_NAME% railway-deploy ^
                    cmd /c "railway whoami && railway up --service %SERVICE_NAME% --detach"
                    """
                }
        }
    }

}

