pipeline {
    agent any
    stages {
        stage('Deploy to Railway') {
            environment {
                RAILWAY_TOKEN = credentials('railway-api-token')
            }
            steps {
                sh '''
                docker run --rm -e RAILWAY_TOKEN=$railway-api-token -e SERVICE_NAME=spring-petclinic-app node:20-alpine sh -c "
                npm install -g @railway/cli &&
                railway up --service $SERVICE_NAME --detach"
                '''
            }
        }
    }
}
