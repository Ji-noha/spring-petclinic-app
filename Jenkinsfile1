pipeline {
    agent any

    environment {
        RAILWAY_TOKEN = credentials('railway-api-token') // Jenkins Secret Text credential ID
        SERVICE_NAME = 'spring-petclinic-app'            // Railway service name
    }

    stages {
        stage('Test Railway Deploy') {
            steps {
                bat """
                echo Deploying to Railway...
                docker run --rm -e RAILWAY_TOKEN=%RAILWAY_TOKEN% -e SERVICE_NAME=%SERVICE_NAME% node:20-alpine sh -c "npm install -g @railway/cli && railway up --service \$SERVICE_NAME --detach"
                """
            }
        }
    }
}
