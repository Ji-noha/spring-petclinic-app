pipeline {
    agent any
    environment {
        SERVICE_NAME = 'spring-petclinic-app'
    }
    stages {
        stage('Checkout') {
            steps { checkout scm }
        }
        stage('Deploy to Railway') {
            steps {
                withCredentials([string(credentialsId: 'railway-api-token', variable: 'RAILWAY_TOKEN')]) {
                    bat """
                        docker run --rm ^
                        -e RAILWAY_TOKEN=%RAILWAY_TOKEN% ^
                        -e SERVICE_NAME=%SERVICE_NAME% ^
                        railway-deploy sh -c "railway whoami && railway up --service $SERVICE_NAME --detach"
                    """
                }
            }
        }

    }
}
